<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<select id="findAll" resultType="boardvo">
		 <![CDATA[
		   select a.no, a.title, a.contents, a.hit, date_format(a.reg_date, '%Y/%m/%d %H:%i:%s') as regDate,
		          a.group_no, a.order_no, a.depth, a.user_no, b.name
		     from board a, user b
		    where a.user_no = b.no
	     order by reg_date desc, group_no desc, order_no asc
		 ]]>
	</select>

	<insert id="insert" parameterType="boardvo">
		<selectKey keyProperty="groupNo" resultType="long" order="BEFORE">
	 		<![CDATA[
	 		select max(group_no)+1 from board
	 		]]>
	 	</selectKey>
	 	<![CDATA[
	 	insert 
	 	  into board 
	 	values(null, #{title }, #{contents }, 0, date_format(now(), '%Y/%m/%d %H:%i:%s'),
					#{groupNo }, 1, 0, #{userNo })
	 	]]>
	 	<selectKey keyProperty="no" resultType="long" order="AFTER">
	 		<![CDATA[
	 		select last_insert_id()
	 		]]>
	 	</selectKey>
	</insert>

	<select id="findByNo" resultType="boardvo" parameterType="long">
		 <![CDATA[
		 select title, contents, hit, user_no as userNo
		   from board
		  where no = #{no }
		 ]]>
	</select>

	<delete id="deleteByNo" parameterType="long">
	 	<![CDATA[
	 	delete 
	 	  from board 
	 	 where no = #{no }
	 	]]>
	</delete>
	
	<update id="update" parameterType="boardvo">
	 	<![CDATA[
	 	update board
	 	   set title=#{title }, contents=#{contents } where no=#{no }
	 	]]>
	</update>
	
	<update id="updateHit" parameterType="boardvo">
	 	<![CDATA[
	 	update board
		   set hit = hit+1
		 where no = #{no }
	 	]]>
	</update>
</mapper>